namespace = Events_GAPS_Traits_Immersers
planet_event = {
    id = Events_GAPS_Traits_Immersers.33
    is_triggered_only = yes
    hide_window = yes
    trigger = {
        FromFrom = {
            has_trait = Trait_GAPS_Immersers
        }
    }
    immediate = {
        This = {
            set_variable = {
                which = "Planet_Variable_GAPS_Num_Blockers"
                value = 0
            }
            every_deposit = {
                limit = {
                    is_blocker = yes
                }
                planet = {
                    change_variable = {
                        which = "Planet_Variable_GAPS_Num_Blockers"
                        value = 1
                    }
                }
            }
            every_owned_pop = {
                limit = {
                    has_trait = Trait_GAPS_Immersers
                    has_modifier = Pop_Modifier_GAPS_Immersers_Boost
                }
                while = {
                    limit = {
                        has_modifier = Pop_Modifier_GAPS_Immersers_Boost
                    }
                    remove_modifier = Pop_Modifier_GAPS_Immersers_Boost
                }
            }
            if = {
                limit = {
                    check_variable = {
                        which = "Planet_Variable_GAPS_Num_Blockers"
                        value = 0
                    }
                }
                every_owned_pop = {
                    limit = {
                        has_trait = Trait_GAPS_Immersers
                    }
                    add_modifier = {
                        modifier = Pop_Modifier_GAPS_Immersers_Penalty
                        days = -1
                    }
                }
            }
            else = {
                while = {
                    count = Planet_Variable_GAPS_Num_Blockers
                    every_owned_pop = {
                        limit = {
                            has_trait = Trait_GAPS_Immersers
                        }
                        add_modifier = {
                            modifier = Pop_Modifier_GAPS_Immersers_Boost
                            days = -1
                        }
                    }
                }
            }
            set_variable = {
                which = "Planet_Variable_GAPS_Num_Immersers_Pops"
                value = 0
            }
            every_deposit = {
                limit = {
                    is_deposit_type = Deposits_GAPS_Immersers
                }
                remove_deposit = yes
            }
            every_owned_pop = {
                limit = {
                    has_trait = Trait_GAPS_Immersers
                }
                planet = {
                    change_variable = {
                        which = "Planet_Variable_GAPS_Num_Immersers_Pops"
                        value = 1
                    }
                }
            }
            while = {
                count = Planet_Variable_GAPS_Num_Immersers_Pops
                add_deposit = Deposits_GAPS_Immersers
            }
        }
    }
}
