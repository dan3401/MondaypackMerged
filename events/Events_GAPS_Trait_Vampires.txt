namespace = Events_GAPS_Traits_Vampire

#CORE EVENT
planet_event = {
	id = Events_GAPS_Traits_Vampire.10
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		set_variable = { which = Planet_Variable_GAPS_Number_Of_Vampires_To_Feed value = 0 }
		set_variable = { which = Planet_Variable_GAPS_Number_Of_Blood_Vessels value = 0 }
		every_owned_pop = {
			remove_modifier = Pop_Modifier_GAPS_Vampire_Species_Fed
			remove_modifier = Pop_Modifier_GAPS_Vampire_Species_Food
		}
		#Count Number Of Vampires
		every_owned_pop = {
			limit = { pop_has_trait = Trait_GAPS_Vampire }
			Root = { change_variable = { which = Planet_Variable_GAPS_Number_Of_Vampires_To_Feed value = 1 } }
		}
		#Count Number Of Non Vampires
		while = {
			count = Planet_Variable_GAPS_Number_Of_Vampires_To_Feed
			random_owned_pop = {
				limit = { NOT = { pop_has_trait = Trait_GAPS_Vampire } NOT = { has_modifier = Pop_Modifier_GAPS_Vampire_Species_Food } }
				add_modifier = { modifier = Pop_Modifier_GAPS_Vampire_Species_Food days = -1 }
				Root = { change_variable = { which = Planet_Variable_GAPS_Number_Of_Blood_Vessels value = 1 } }
			}
		}
		#Apply Effects
		while = {
			count = Planet_Variable_GAPS_Number_Of_Blood_Vessels
			random_owned_pop = {
				limit = { pop_has_trait = Trait_GAPS_Vampire NOT = { has_modifier = Pop_Modifier_GAPS_Vampire_Species_Fed } }
				add_modifier = { modifier = Pop_Modifier_GAPS_Vampire_Species_Fed days = -1 }
			}
		}
	}
}
# A pop has been added to the planet
# Root = pop
# From = planet
#on_pop_added
pop_event = {
	id = Events_GAPS_Traits_Vampire.20
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		From = { any_owned_pop = { pop_has_trait = Trait_GAPS_Vampire } }
	}
	immediate = {
		From = {	
			planet_event = { id = Events_GAPS_Traits_Vampire.10 days = 1 }
		}
	}
}
# Pop is abducted by raiding stance
# This = Pop scope
# From = planet abducted from
planet_event = {
	id = Events_GAPS_Traits_Vampire.21
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		From = { any_owned_pop = { has_trait = Trait_GAPS_Vampire } }
	}
	immediate = {
		From = {	
			planet_event = { id = Events_GAPS_Traits_Vampire.10 days = 1 }
		}
	}
}
# A pop has finished purging
# This = Planet scope
# From = Country
# FromFrom = Pop
planet_event = {
	id = Events_GAPS_Traits_Vampire.22
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		This = { any_owned_pop = { has_trait = Trait_GAPS_Vampire } }
	}
	immediate = {
		This = {	
			planet_event = { id = Events_GAPS_Traits_Vampire.10 days = 1 }
		}
	}
}
# A pop has finished declining (while not being purged)
# This = Planet scope
# From = Country
# FromFrom = Pop
planet_event = {
	id = Events_GAPS_Traits_Vampire.23
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		This = { any_owned_pop = { has_trait = Trait_GAPS_Vampire } }
	}
	immediate = {
		This = {	
			planet_event = { id = Events_GAPS_Traits_Vampire.10 days = 1 }
		}
	}
}
# A pop has been displaced
# This = Planet scope
# From = Country
# FromFrom = Pop
planet_event = {
	id = Events_GAPS_Traits_Vampire.24
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		This = { any_owned_pop = { has_trait = Trait_GAPS_Vampire } }
	}
	immediate = {
		This = {	
			planet_event = { id = Events_GAPS_Traits_Vampire.10 days = 1 }
		}
	}
}

# This = Planet where the pop was bombed to death
# From = Country which is raining down fire and brimstone
#on_pop_bombed_to_death = {
planet_event = {
	id = Events_GAPS_Traits_Vampire.25
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		This = { any_owned_pop = { has_trait = Trait_GAPS_Vampire } }
	}
	immediate = {
		This = {	
			planet_event = { id = Events_GAPS_Traits_Vampire.10 days = 1 }
		}
	}
}

