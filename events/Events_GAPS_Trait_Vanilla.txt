namespace = Events_GAPS_Traits_Vanilla

#CORE EVENT
planet_event = {
	id = Events_GAPS_Traits_Vanilla.10
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		every_owned_pop = {
			remove_modifier = Pop_Modifier_GAPS_Vanilla_Bonus
			set_variable = { which = "Pop_Variable_GAPS_Num_Core_Civics" value = 0 }
		}
		owner = { 
			set_variable = { which = "Country_Variable_GAPS_Num_Non_Mod_Civics" value = 0 }
			Scripted_Country_Effect_GAPS_Count_Core_Civics = yes
			if = {
				limit = { check_variable = { which = "Country_Variable_GAPS_Num_Non_Mod_Civics" value > 3 } }
				set_variable = { which = "Country_Variable_GAPS_Num_Non_Mod_Civics" value = 3 }
			}
			while = {
				count = Country_Variable_GAPS_Num_Non_Mod_Civics
				root = {
					every_owned_pop = {
						limit = { pop_has_trait = Trait_GAPS_Vanilla }
						change_variable = { which = "Pop_Variable_GAPS_Num_Core_Civics" value = 1 }
					}
				}
			}
		}
		every_owned_pop = {	
			limit = { pop_has_trait = Trait_GAPS_Vanilla }
			add_modifier = { 
				modifier = Pop_Modifier_GAPS_Vanilla_Bonus 
				days = -1
				multiplier = Pop_Variable_GAPS_Num_Core_Civics
			}
		}
	}
}
# Root = pop
# From = planet
#on_pop_added
pop_event = {
	id = Events_GAPS_Traits_Vanilla.20
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		Root = { has_trait = Trait_GAPS_Vanilla }
	}
	immediate = {
		From = { planet_event = { id = Events_GAPS_Traits_Vanilla.10 days = 1 } }
	}
}

# Executed just as country is changing its government, after the new one is applied
# THIS = country
#on_post_government_changed = {
country_event = {
	id = Events_GAPS_Traits_Vanilla.30
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		any_owned_species = { has_trait = Trait_GAPS_Vanilla }
	}
	immediate = {
		every_owned_planet = {
			planet_event = { id = Events_GAPS_Traits_Vanilla.10 days = 1 }
		}
	}
}